<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ofis Gaz Sim√ºlasyonu ‚Äî √ñl√ºmc√ºl Seviye Desteƒüi</title>
<style>
  :root{
    --bg:#0d1117; --panel:#0f1620; --card:#11161b; --accent:#00ff9d; --muted:#9ca3af;
    --danger:#ff5555;
  }
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", system-ui, Arial; background:var(--bg); color:#e6edf3;}
  .app {display:flex;gap:18px;padding:18px;box-sizing:border-box;height:100%;}
  /* Left: Simulation panel */
  .left {flex:1; background:linear-gradient(180deg,#0f1720 0,#0b1116 100%); border-radius:12px; padding:18px; box-shadow:0 6px 30px rgba(0,0,0,.6); min-width:360px;}
  .left header{display:flex;align-items:baseline;justify-content:space-between;gap:12px;}
  h1{margin:0;color:var(--accent);font-size:1.15rem;}
  .info{color:var(--muted);font-size:0.85rem;margin-bottom:12px;}
  .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px;}
  select,button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px;border-radius:8px;font-weight:600;cursor:pointer;}
  button:hover, select:hover{opacity:.9}
  .reset{background:var(--danger);border-color:var(--danger);color:white}
  .sim-grid{display:grid;grid-template-columns:repeat(1,1fr);gap:12px}
  .gas-card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.5);display:flex;flex-direction:column;gap:8px;}
  .bar{height:16px;border-radius:8px; background:linear-gradient(90deg,#00ff9d,#ff3b3b); overflow:hidden;}
  .card-row{display:flex;justify-content:space-between;align-items:center;gap:8px;}
  .muted{color:var(--muted);font-size:0.85rem;}
  .status{font-weight:700;}
  .warning{color:var(--danger);font-weight:800;}
  .small-btn{padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--accent);cursor:pointer}
  /* Right: Building map */
  .right {width:520px; background:linear-gradient(180deg,#071018 0,#071018 60%); border-radius:12px;padding:18px; box-shadow:0 6px 30px rgba(0,0,0,.6);}
  .top-controls{display:flex;gap:10px;align-items:center;margin-bottom:12px;}
  .floor-select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--accent);font-weight:700}
  .building{display:flex;flex-direction:column; gap:12px;}
  .floor{background:linear-gradient(180deg,#0b1b22,#071218);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.03)}
  .floor h3{margin:0;font-size:0.95rem;color:#a7f7c7;display:flex;justify-content:space-between;align-items:center}
  .rooms{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
  .room{background:#07121a;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.03);min-height:64px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;position:relative;transition:transform .12s}
  .room:hover{transform:translateY(-4px)}
  .room .label{font-weight:700;color:var(--accent);font-size:0.9rem}
  .room .sub{font-size:0.78rem;color:var(--muted)}
  .room .icon{position:absolute;top:8px;right:8px;font-size:18px}
  /* threat colors */
  .threat-green{box-shadow:0 6px 18px rgba(0,255,157,0.06);border:1px solid rgba(0,255,157,0.12)}
  .threat-yellow{box-shadow:0 6px 18px rgba(255,212,6,0.06);border:1px solid rgba(255,212,6,0.12)}
  .threat-red{box-shadow:0 6px 18px rgba(255,60,60,0.06);border:1px solid rgba(255,60,60,0.12)}
  .icon-green{color:#00ff9d}
  .icon-yellow{color:#ffd600}
  .icon-red{color:#ff5555}
  /* selected room highlighting */
  .room.selected{outline:3px solid rgba(255,255,255,0.04);transform:scale(1.02)}
  /* right side legend */
  .legend{display:flex;gap:8px;align-items:center;margin-top:10px;color:var(--muted);font-size:0.85rem}
  .legend-item{display:flex;gap:6px;align-items:center}
  .dot{width:12px;height:12px;border-radius:50%}
  .dot.green{background:#00ff9d}
  .dot.yellow{background:#ffd600}
  .dot.red{background:#ff5555}
  /* responsive */
  @media (max-width:980px){
    .app{flex-direction:column;padding:12px}
    .right{width:100%}
  }
</style>
</head>
<body>
  <div class="app">
    <!-- LEFT: Simulation & Room details -->
    <div class="left">
      <header>
        <div>
          <h1>‚ò£Ô∏è Zehirli Gaz Sim√ºlasyonu</h1>
          <div class="info">Her gazƒ± √∂l√ºmc√ºl seviyeye √ßƒ±karma (‚ö†Ô∏è) desteƒüi eklendi.</div>
        </div>
        <div class="muted">3 Kat ‚Ä¢ 6 Oda / Kat</div>
      </header>

      <div style="margin-top:10px" class="controls">
        <select id="globalGasSelect">
          <option disabled selected>Gaz Se√ß</option>
        </select>
        <button id="addToRoomBtn">Odaya Ekle</button>
        <button id="addLethalBtn" title="Se√ßili gazƒ± doƒürudan √∂l√ºmc√ºl d√ºzeye getir">√ñl√ºmc√ºl Ekle</button>
        <button id="clearRoomBtn" class="reset">Odadaki Gazlarƒ± Temizle</button>
      </div>

      <div id="selectedRoomInfo" class="sim-grid">
        <div class="gas-card" id="noRoomCard">
          <div class="muted">Hen√ºz bir oda se√ßilmedi. Saƒü taraftan bir oda se√ß.</div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
          <div class="muted">T√ºm bina g√ºncelleniyor ‚Äî ger√ßek zamanlƒ± (1.5s)</div>
          <div class="muted">Durumlar: <span style="font-weight:700">üü¢ D√º≈ü√ºk ‚Ä¢ üü° Orta ‚Ä¢ üî¥ Y√ºksek</span></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Building map -->
    <div class="right">
      <div class="top-controls">
        <label for="floorSelect" class="muted">Kat Se√ß:</label>
        <select id="floorSelect" class="floor-select">
          <option value="2">3. Kat</option>
          <option value="1">2. Kat</option>
          <option value="0" selected>1. Kat</option>
        </select>
        <div style="flex:1"></div>
        <div class="legend">
          <div class="legend-item"><div class="dot green"></div> D√º≈ü√ºk</div>
          <div class="legend-item"><div class="dot yellow"></div> Orta</div>
          <div class="legend-item"><div class="dot red"></div> Y√ºksek</div>
        </div>
      </div>

      <div class="building" id="building"></div>
    </div>
  </div>

<script>
/* --- Ayarlar --- */
const MAX_LEVEL = 200; // artƒ±k 100'√ºn √ºst√ºne izin veriyoruz (√∂l√ºmc√ºl i√ßin gerekli)
const LETHAL_LEVEL = 130; // seviye deƒüeri (>=) -> getEffect i√ßindeki √∂l√ºmc√ºl e≈üik ge√ßilsin

/* --- Gaz veri tabanƒ± --- */
const gasesData = [
  { name: "Karbon Monoksit (CO)", sources: "Yanma sistemleri, egzozlar", danger: 55, effect: ["Ba≈ü aƒürƒ±sƒ±","Bilin√ß kaybƒ±","√ñl√ºmc√ºl"] },
  { name: "Azot Oksitler (NO‚Çì)", sources: "Yanma sistemleri, egzozlar", danger: 40, effect: ["Solunum zorluƒüu","Akciƒüer hasarƒ±","Organ yetmezliƒüi"] },
  { name: "K√ºk√ºrt Dioksit (SO‚ÇÇ)", sources: "End√ºstriyel prosesler, yakƒ±tlar", danger: 20, effect: ["Boƒüaz yanmasƒ±","Nefes darlƒ±ƒüƒ±","Solunum yetmezliƒüi"] },
  { name: "U√ßucu Organik Bile≈üikler (VOCs)", sources: "Temizlik √ºr√ºnleri, boyalar", danger: 10, effect: ["Ba≈ü d√∂nmesi","Yorgunluk","Sinir sistemi hasarƒ±"] },
  { name: "Metan (CH‚ÇÑ)", sources: "Maden gazƒ±, hayvancƒ±lƒ±k", danger: 60, effect: ["Patlama riski","Boƒüulma","Bilinci kaybƒ±"] },
  { name: "Hidrojen S√ºlf√ºr (H‚ÇÇS)", sources: "Maden, atƒ±k √ßukurlarƒ±", danger: 5, effect: ["Koku e≈üiƒüi kaybƒ±","Solunum felci","√ñl√ºmc√ºl"] },
  { name: "Amonyak (NH‚ÇÉ)", sources: "G√ºbreler, hayvansal atƒ±klar", danger: 25, effect: ["G√∂z yanmasƒ±","Akciƒüer tahri≈üi","Zehirlenme"] }
];

/* --- Bina veri yapƒ±sƒ±: 3 kat, her katta 6 oda --- */
const FLOORS = 3;
const ROOMS_PER_FLOOR = 6;
const buildingData = Array.from({length:FLOORS}, (_,f) => ({
  floorIndex: f,
  rooms: Array.from({length:ROOMS_PER_FLOOR}, (_,r) => ({
    id: `F${f+1}R${r+1}`,
    gases: [] // her madde: {name, danger, level(0-200), sources, effect}
  }))
}));

/* --- DOM refs --- */
const buildingEl = document.getElementById('building');
const floorSelect = document.getElementById('floorSelect');
const globalGasSelect = document.getElementById('globalGasSelect');
const addToRoomBtn = document.getElementById('addToRoomBtn');
const addLethalBtn = document.getElementById('addLethalBtn');
const clearRoomBtn = document.getElementById('clearRoomBtn');
const selectedRoomInfo = document.getElementById('selectedRoomInfo');

let selected = { floor: 0, roomIndex: 0 };

function init(){
  // populate gas select
  gasesData.forEach((g,i)=>{
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `${g.name} ‚Äî ${g.sources}`;
    globalGasSelect.appendChild(opt);
  });

  renderBuilding();
  selectRoom(0,0); // default
  setInterval(updateSimulation,1500);
}

function renderBuilding(){
  buildingEl.innerHTML = '';
  // render floors top-down (3rd floor first for visual)
  for(let f = FLOORS-1; f>=0; f--){
    const floor = buildingData[f];
    const floorDiv = document.createElement('div');
    floorDiv.className = 'floor';
    const floorTitle = document.createElement('h3');
    floorTitle.innerHTML = `Kat ${f+1} <span class="muted">(${floor.rooms.length} oda)</span>`;
    floorDiv.appendChild(floorTitle);

    const roomsDiv = document.createElement('div');
    roomsDiv.className = 'rooms';
    floor.rooms.forEach((room,ri)=>{
      const rEl = document.createElement('div');
      rEl.className = 'room';
      rEl.dataset.floor = f;
      rEl.dataset.room = ri;

      const label = document.createElement('div'); label.className='label'; label.textContent = room.id;
      const sub = document.createElement('div'); sub.className='sub';
      sub.textContent = room.gases.length ? `${room.gases.length} gaz` : 'Temiz';

      const icon = document.createElement('div'); icon.className='icon'; icon.innerHTML = '';
      rEl.appendChild(label);
      rEl.appendChild(sub);
      rEl.appendChild(icon);

      // click handler
      rEl.addEventListener('click', ()=> selectRoom(f,ri) );

      roomsDiv.appendChild(rEl);
    });

    floorDiv.appendChild(roomsDiv);
    buildingEl.appendChild(floorDiv);
  }
  updateRoomVisuals();
}

function selectRoom(floor, roomIndex){
  selected.floor = floor;
  selected.roomIndex = roomIndex;
  floorSelect.value = floor;
  document.querySelectorAll('.room').forEach(el=>{
    el.classList.remove('selected');
    if(Number(el.dataset.floor)===floor && Number(el.dataset.room)===roomIndex) el.classList.add('selected');
  });
  showSelectedRoomInfo();
}

floorSelect.addEventListener('change', (e)=>{
  const f = Number(e.target.value);
  selectRoom(f,0);
});

function showSelectedRoomInfo(){
  selectedRoomInfo.innerHTML = '';
  const room = buildingData[selected.floor].rooms[selected.roomIndex];

  const headerCard = document.createElement('div');
  headerCard.className = 'gas-card';
  headerCard.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;">
    <div>
      <div style="font-weight:800">${room.id}</div>
      <div class="muted">Kat ${selected.floor+1} ‚Ä¢ Oda ${selected.roomIndex+1}</div>
    </div>
    <div class="muted">Gaza maruz kalan: <strong>${room.gases.length}</strong></div>
  </div>`;
  selectedRoomInfo.appendChild(headerCard);

  if(room.gases.length === 0){
    const tip = document.createElement('div');
    tip.className = 'gas-card';
    tip.innerHTML = `<div class="muted">Bu oda temiz. Saƒüdan bir gaz se√ßip "Odaya Ekle" ya da "√ñl√ºmc√ºl Ekle" butonuna bas.</div>`;
    selectedRoomInfo.appendChild(tip);
  } else {
    room.gases.forEach((g,gi)=>{
      const gcard = document.createElement('div'); gcard.className='gas-card';
      const mgValue = ((g.level/100)*g.danger);
      const effect = getEffect(mgValue, g);
      const visualWidth = Math.min(100, g.level); // bar g√∂rseli 100%'√º ge√ßmez
      const isLethal = mgValue >= (g.danger * 1.2);
      gcard.innerHTML = `
        <div class="card-row">
          <div>
            <div style="font-weight:800">${g.name}${isLethal? ' ‚ö†Ô∏è (√ñL√úMC√úL)':''}</div>
            <div class="muted">${g.sources}</div>
          </div>
          <div style="text-align:right">
            <div class="muted">Yoƒüunluk</div>
            <div style="font-weight:800">${mgValue.toFixed(1)} mg/m¬≥</div>
          </div>
        </div>
        <div class="bar" style="width:${visualWidth}%;"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
          <div class="status">Etki: ${effect}</div>
          <div>
            <button class="small-btn" onclick="increaseGas(${selected.floor},${selected.roomIndex},${gi})">Gaz Sal (+)</button>
            <button class="small-btn" onclick="makeGasLethal(${selected.floor},${selected.roomIndex},${gi})">√ñl√ºmc√ºl Yap</button>
            <button class="small-btn" onclick="removeGasFromRoom(${selected.floor},${selected.roomIndex},${gi})">‚ùå Kaldƒ±r</button>
          </div>
        </div>
      `;
      selectedRoomInfo.appendChild(gcard);
    });
  }

  // controls beneath for adding selected gas
  const controlCard = document.createElement('div'); controlCard.className='gas-card';
  controlCard.innerHTML = `<div style="display:flex;gap:8px;align-items:center">
    <div class="muted">Se√ßili gaz:</div>
    <div id="currentSelectedGas" style="font-weight:800">${globalGasSelect.selectedOptions.length?globalGasSelect.selectedOptions[0].text:'(Se√ßin)'}</div>
  </div>
  <div style="display:flex;gap:8px;margin-top:8px">
    <button class="small-btn" id="quickAddBtn">Hƒ±zlƒ± Ekle (+10)</button>
    <button class="small-btn" id="multiAddBtn">B√ºy√ºk Salƒ±m (+30)</button>
    <button class="small-btn" id="lethalAddBtn">Hƒ±zlƒ± √ñl√ºmc√ºl</button>
  </div>`;
  selectedRoomInfo.appendChild(controlCard);

  // attach handlers
  document.getElementById('currentSelectedGas').textContent = globalGasSelect.selectedOptions.length?globalGasSelect.selectedOptions[0].text:'(Se√ßin)';
  document.getElementById('quickAddBtn').onclick = ()=> {
    addSelectedGasToRoom(10 + Math.random()*5);
  };
  document.getElementById('multiAddBtn').onclick = ()=> {
    addSelectedGasToRoom(30 + Math.random()*10);
  };
  document.getElementById('lethalAddBtn').onclick = ()=> {
    addSelectedGasToRoomToLethal();
  };
}

/* --- Gas manipulation --- */
function addSelectedGasToRoom(incrementLevel=0){
  const idx = Number(globalGasSelect.value);
  if(isNaN(idx)) { alert('L√ºtfen bir gaz se√ßin.'); return; }
  const gInfo = gasesData[idx];
  const room = buildingData[selected.floor].rooms[selected.roomIndex];

  const existing = room.gases.find(g=>g.name===gInfo.name);
  if(existing){
    existing.level = Math.min(MAX_LEVEL, existing.level + (incrementLevel || 20 + Math.random()*5));
  } else {
    room.gases.push({...gInfo, level: Math.min(MAX_LEVEL, (incrementLevel || 20 + Math.random()*5))});
  }
  renderBuilding();
  showSelectedRoomInfo();
}

function addSelectedGasToRoomToLethal(){
  const idx = Number(globalGasSelect.value);
  if(isNaN(idx)) { alert('L√ºtfen bir gaz se√ßin.'); return; }
  const gInfo = gasesData[idx];
  const room = buildingData[selected.floor].rooms[selected.roomIndex];

  // hedef: mgValue >= gas.danger * 1.2 -> level_needed = 1.2 * 100 = 120
  // biz g√ºvenlik i√ßin LETHAL_LEVEL kullanƒ±yoruz (√∂rn 130)
  const targetLevel = Math.min(MAX_LEVEL, LETHAL_LEVEL);

  const existing = room.gases.find(g=>g.name===gInfo.name);
  if(existing){
    existing.level = Math.max(existing.level, targetLevel);
  } else {
    room.gases.push({...gInfo, level: targetLevel});
  }
  renderBuilding();
  showSelectedRoomInfo();
}

addToRoomBtn.addEventListener('click', ()=> addSelectedGasToRoom(20 + Math.random()*8));
addLethalBtn.addEventListener('click', ()=> addSelectedGasToRoomToLethal());

clearRoomBtn.addEventListener('click', ()=>{
  const room = buildingData[selected.floor].rooms[selected.roomIndex];
  room.gases = [];
  renderBuilding();
  showSelectedRoomInfo();
});

function increaseGas(floor, roomIndex, gasIndex){
  const room = buildingData[floor].rooms[roomIndex];
  room.gases[gasIndex].level = Math.min(MAX_LEVEL, room.gases[gasIndex].level + 12 + Math.random()*8);
  renderBuilding();
  if(floor===selected.floor && roomIndex===selected.roomIndex) showSelectedRoomInfo();
}
window.increaseGas = increaseGas;

function makeGasLethal(floor, roomIndex, gasIndex){
  const room = buildingData[floor].rooms[roomIndex];
  room.gases[gasIndex].level = Math.min(MAX_LEVEL, Math.max(room.gases[gasIndex].level, LETHAL_LEVEL));
  renderBuilding();
  if(floor===selected.floor && roomIndex===selected.roomIndex) showSelectedRoomInfo();
}
window.makeGasLethal = makeGasLethal;

function removeGasFromRoom(floor, roomIndex, gasIndex){
  const room = buildingData[floor].rooms[roomIndex];
  room.gases.splice(gasIndex,1);
  renderBuilding();
  if(floor===selected.floor && roomIndex===selected.roomIndex) showSelectedRoomInfo();
}
window.removeGasFromRoom = removeGasFromRoom;

/* --- Simulation tick --- */
function updateSimulation(){
  // natural decay and propagation (small randomness)
  for(const floor of buildingData){
    for(const room of floor.rooms){
      room.gases.forEach(g=>{
        // natural slight dissipation; daha y√ºksek seviyelerde yava≈ü azalma
        const decay = 0.6 + Math.random()*0.8;
        // y√ºksek seviyede (√∂l√ºmc√ºl) biraz daha stabil kalabilir -> azaltƒ±yoruz
        g.level = Math.max(0, g.level - (decay * (g.level > 100 ? 0.6 : 1)));
      });
      // spread small amount to neighboring rooms same floor
      if(room.gases.length>0 && Math.random() < 0.08){
        const floorObj = buildingData[floor.floorIndex];
        const roomIndex = floorObj.rooms.indexOf(room);
        const neighbors = [];
        if(roomIndex>0) neighbors.push(roomIndex-1);
        if(roomIndex < floorObj.rooms.length-1) neighbors.push(roomIndex+1);
        if(neighbors.length){
          const ni = neighbors[Math.floor(Math.random()*neighbors.length)];
          const donor = room.gases[0];
          const neighborRoom = floorObj.rooms[ni];
          let existing = neighborRoom.gases.find(x=>x.name===donor.name);
          const transfer = Math.min(8, donor.level * 0.06 + Math.random()*3);
          if(existing){
            existing.level = Math.min(MAX_LEVEL, existing.level + transfer);
          } else {
            neighborRoom.gases.push({...donor, level: Math.min(MAX_LEVEL, transfer)});
          }
        }
      }
      // remove gases with level ~0
      room.gases = room.gases.filter(g=>g.level > 0.4);
    }
  }
  updateRoomVisuals();
  if(buildingData[selected.floor].rooms[selected.roomIndex]){
    showSelectedRoomInfo();
  } else {
    selectRoom(0,0);
  }
}

/* --- Visual update of rooms based on threat --- */
function updateRoomVisuals(){
  document.querySelectorAll('.room').forEach(el=>{
    const f = Number(el.dataset.floor);
    const r = Number(el.dataset.room);
    const room = buildingData[f].rooms[r];
    const mgSum = room.gases.reduce((s,g)=> s + ((g.level/100)*g.danger), 0);
    const maxSum = room.gases.reduce((s,g)=> s + g.danger, 0) || 1;
    const ratio = mgSum / maxSum;
    el.classList.remove('threat-green','threat-yellow','threat-red');
    const icon = el.querySelector('.icon');
    el.querySelector('.sub').textContent = room.gases.length ? `${room.gases.length} gaz ‚Ä¢ ${mgSum.toFixed(1)} mg/m¬≥` : 'Temiz';
    if(room.gases.length === 0){
      icon.innerHTML = '';
    } else if(ratio < 0.4){
      el.classList.add('threat-green');
      icon.innerHTML = `<span class="icon-green">üü¢</span>`;
    } else if(ratio < 0.8){
      el.classList.add('threat-yellow');
      icon.innerHTML = `<span class="icon-yellow">‚ö†Ô∏è</span>`;
    } else {
      el.classList.add('threat-red');
      // if √ßok y√ºksekse (√∂r. mgSum / maxSum > 1.2) g√∂sterimi g√º√ßlendir
      if(ratio > 1.2) icon.innerHTML = `<span class="icon-red">‚ùó‚ùó</span>`;
      else icon.innerHTML = `<span class="icon-red">‚ùó</span>`;
    }
  });
}

/* --- Helper effect calculation (aynƒ± mantƒ±k) --- */
function getEffect(level, gas){
  if (level < gas.danger * 0.5) return gas.effect[0];
  if (level < gas.danger * 1.2) return gas.effect[1];
  return gas.effect[2];
}

window.addSelectedGasToRoom = addSelectedGasToRoom;
window.addSelectedGasToRoomToLethal = addSelectedGasToRoomToLethal;

/* init */
init();
</script>
</body>
</html>

